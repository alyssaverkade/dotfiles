#!/usr/bin/env bash

set -e

if [[ $# -eq 0 ]]; then
  AWS_PROFILE="$(aws-profiles)"
else
  AWS_PROFILE="$1"
fi

if [[ -n "$2" ]]; then
  ECS_CLUSTER="$2"
else
  ECS_CLUSTERS=$(ecs-clusters "${AWS_PROFILE}")""
  ECS_CLUSTER="$(fzy <<< "${ECS_CLUSTERS}")"
fi

if [[ -n "$3" ]]; then
  ECS_SERVICE="$3"
else
  ECS_SERVICES="$(ecs-services "${AWS_PROFILE}" "${ECS_CLUSTER}")"
  ECS_SERVICE="$(fzy <<< "${ECS_SERVICES}")"
fi

ECS_TASKS="$(set -x; aws ecs list-tasks --profile "${AWS_PROFILE}" --cluster "${ECS_CLUSTER}" --service-name "${ECS_SERVICE}")"
jq -r '.taskArns | .[]'  <<< "${ECS_TASKS}"
